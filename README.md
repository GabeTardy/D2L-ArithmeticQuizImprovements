# D2L-Partial-Credit (Alpha)
**This script is a work in progress.**

D2L does not natively provide a system for multi-part arithmetic questions and also does not provide a system for assigning partial credit to arithmetic problems based on a formula. For example, it **should** theoretically be possible to have a correct answer calculated in the normal way as default whose value is then used as a parameter in the next answer's formula for its solution. Moreover, it should be possible to create another formula which incorporates a common mistake which gives partial credit on each part of the multipart problem. Lastly, it is impossible to use inverse trigonometric functions in arithmetic questions, which is somewhat common in my area. However, none of this functionality exists and none is on the D2L roadmap, which is a massive pity, seeing as this advanced functionality has been requested many times:
- [D2L Request Link 1](https://community.d2l.com/brightspace/discussion/3765/is-it-possible-to-make-multi-part-arithmetic-quiz-questions)
- [D2L Request Link 2](https://community.d2l.com/brightspace/discussion/7085/arithmetic-question-with-multiple-formulas)
- [D2L Request Link 3](https://community.d2l.com/brightspace/discussion/4553/advanced-functionality-for-quizzes-arithmetic)
- [D2L Request Link 4](https://community.d2l.com/brightspace/discussion/2604/arithmetic-variable-contingent-on-another-variable)

There are even more requests on the PIE forum (D8351, D6350, D6891, etc.), which are not available to the public.

Therefore, this joint Tampermonkey/Maple script intends to solve both issues for my D2L course by outsourcing validation to an external script created in Maple, which has basically every mathematical operation known to man, whose results are then injected into the D2L grading view by Tampermonkey using an imported JSON file. This script will recalculate subsequent problem parts incorporating student errors to determine whether they followed proper procedure or not, assigning reasonable partial credit as it goes. (Flowchart forthcoming.)

D2L obfuscates much of its internals (and probably simplfies its own development internally) via extensive use of Shadow DOM, which makes injection of this kind extremely difficult. Therefore, the userscript also contains a caching system which flattens the Shadow DOM for simplified searching.

**This script is not intended to be a permanent solution to these issues, as I hope that D2L improves their arithmetic quizzes in a future roadmap. Please do not stop asking for these changes to be made.**

## Current Features and Changelog
- **v0.0.2a**
  - d2l.user.js
    - **Major cornerstone feature: Bulk assign all grades in currently evaluated quiz at once based on input array of problem/subproblem grades: `TGrader.setGrades(gradeArray)`**
    - Implemented getters for currently-assigned grade for student by problem and subproblem
      - Individual grade: `TGrader.getGrade(problemNumber, subpartNumber, gradeFloat)`
      - Bulk grades: `TGrader.getGrades()`
    - Implemented student name getter: `TGrader.getCurrentStudentName()`
    - Known issue: grade input locations are not cached, so this might be slow for large quizzes. I tested this on a quiz with 12 questions.
- **v0.0.1a**
  - Created d2l.user.js
    - Assign grades to question parts in the quiz grade view via an exposed JS grade manager

## Planned Features
- Generate problem steps and automatically calculate student mistake locations in a corresponding Maple script
- Automatically apply grades to arithmetic question subparts in D2L via a CSV file generated by Maple. 

## Requirements
- Maple 2025.1 or higher
- A modern browser running the Tampermonkey extension

## Installation
- Open d2l.user.js:
  - Click "Raw" in the editor. This will allow Tampermonkey to install the user script.
  - Ensure that the user script is enabled in the quiz grade view.

## Usage
1. In D2L, set up your quiz such that each "Section" corresponds to your overarching question. This "Section" **must** contain arithmetic questions corresponding to your sub-questions. You **must not** randomize the question order or the question order within sections whatsoever.
2. Students will complete the quiz.
3. Open the quiz grade view.
4. Open the developer console in your browser and run:
```js
window.TGrader.setGrade(problemNumber, subpartNumber, gradeFloat);
```
where:
- `problemNumber` is the index of the problem (Problem **1**, Problem **2**, etc.)
- `subpartNumber` is the index of the subpart within the problem (Problem 1(a) -> **1**, Problem 1(b) -> **2**, etc.)
- `gradeFloat` is the grade assigned, which is a number, not a percentage.